<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <!-- –ó–∞–ø—Ä–µ—â–∞–µ–º –∑—É–º, —á—Ç–æ–±—ã –±—ã–ª–æ –∫–∞–∫ –Ω–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
  <!-- –¶–≤–µ—Ç —à–∞–ø–∫–∏ (Android) -->
  <meta name="theme-color" content="#1976d2">
  
  <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è iOS (iPhone) -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="–†–æ–±–æ—Ç-—Ç–µ—Ö–Ω–∏–∫">

  <!-- –í–ê–ñ–ù–û: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—É—Ç–∏ –∫ static -->
  <link rel="manifest" href="/static/manifest.json">
  <link rel="shortcut icon" href="/static/icons/robot-technik.png">
  <link rel="apple-touch-icon" href="/static/icons/robot-technik.png">

  <!-- –°—Ç–∏–ª–∏ —Ç–æ–∂–µ –±–µ—Ä–µ–º –∏–∑ static -->
  <link rel="stylesheet" href="/static/style.css">
  
  <!-- html2pdf library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <title>–†–æ–±–æ—Ç-—Ç–µ—Ö–Ω–∏–∫</title>
</head>
<body>
  <main class="app-container">
    <!-- –í–∫–ª–∞–¥–∫–∞ –ì–õ–ê–í–ù–ê–Ø (–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞) -->
    <section id="home" class="view active">
      <h1>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h1>
      
      <div class="actions-grid">
        <label class="big-btn" for="cameraInput">
          <span style="font-size: 24px;">üì∏</span><br>–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ
        </label>
        <input id="cameraInput" type="file" accept="image/*" capture="environment" style="display:none">
        
        <label class="big-btn" for="galleryInput">
          <span style="font-size: 24px;">üñºÔ∏è</span><br>–ò–∑ –≥–∞–ª–µ—Ä–µ–∏
        </label>
        <input id="galleryInput" type="file" accept="image/*" style="display:none">
      </div>

      <div id="resultBox" class="card" style="display:none">
        <div id="previewWrap">
          <img id="previewImg" alt="Preview" style="max-width:100%; border-radius: 8px;">
        </div>
        
        <div id="detectedText" class="chip" style="margin-top: 10px; font-weight: bold; width: 100%; text-align: center; padding: 10px;"></div>
        
        <div id="symptomBox" style="margin-top:15px; display:none">
          <label for="symptomInput" style="font-size: 14px; color: #666;">–ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å?</label>
          <input id="symptomInput" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è" style="margin-bottom: 10px;">
          
          <button id="solveBtn" class="primary-btn" style="width:100%">–ü–æ–ª—É—á–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ</button>
        </div>

        <div id="aiChecklist" style="margin-top: 15px;"></div>
        
        <!-- –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è -->
        <div class="action-bar" style="margin-top:10px; justify-content: center;">
             <button id="printBtn" class="secondary-btn" style="display: none;">üì• –°–∫–∞—á–∞—Ç—å —á–µ–∫-–ª–∏—Å—Ç</button>
        </div>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –≤–Ω–∏–∑—É) -->
      <button id="installBtn" class="install-float-btn" style="display:none;">
          üì≤ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
      </button>
    </section>

    <!-- –í–∫–ª–∞–¥–∫–∞ –ß–ê–¢ -->
    <section id="chat" class="view">
      <h1>–ß–∞—Ç-–ø–æ–º–æ—â–Ω–∏–∫</h1>
      <div id="chatOut">
        <div class="msg-ai">–ü—Ä–∏–≤–µ—Ç! –Ø –†–æ–±–æ—Ç-—Ç–µ—Ö–Ω–∏–∫. –û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É, –∏ —è –ø–æ–¥—Å–∫–∞–∂—É —Ä–µ—à–µ–Ω–∏–µ.</div>
      </div>
      
      <div class="chat-controls">
        <input id="chatInput" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å...">
        <!-- –°–∫—Ä—ã—Ç—ã–π –∏–Ω–ø—É—Ç –¥–ª—è —Ñ–∞–π–ª–∞ -->
        <input type="file" id="chatFileInput" style="display: none;" accept=".txt,.pdf">
        <div class="chat-buttons">
            <button id="attachBtn">üìé</button>
            <button id="micBtn">üéôÔ∏è</button>
            <button id="sendBtn">‚û§</button>
        </div>
      </div>
    </section>

    <!-- –í–∫–ª–∞–¥–∫–∞ –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô -->
    <section id="knowledge" class="view">
      <h1>–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</h1>
      <div class="kb-filters" id="kbFilters"></div>
      <div class="kb-list" id="kbList"></div>
    </section>
  </main>

  <nav class="tabbar">
    <button data-view="home" class="tab active">
        <span>üì∑</span>
        <span>–ì–ª–∞–≤–Ω–∞—è</span>
    </button>
    <button data-view="chat" class="tab">
        <span>üí¨</span>
        <span>–ß–∞—Ç</span>
    </button>
    <button data-view="knowledge" class="tab">
        <span>üìö</span>
        <span>–ë–∞–∑–∞</span>
    </button>
  </nav>

  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ (—É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É—Ç—å –≤–µ—Ä–Ω—ã–π) -->
  <script src="/static/js/script.js"></script>

  <!-- –í–ê–ñ–ù–û: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker (–ë–µ–∑ —ç—Ç–æ–≥–æ –∫–Ω–æ–ø–∫–∏ "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" –ù–ï –ë–£–î–ï–¢) -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/static/sw.js')
          .then((reg) => console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!', reg))
          .catch((err) => console.log('–û—à–∏–±–∫–∞ SW:', err));
      });
    }

    // –õ–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–∫–∏ "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');

    window.addEventListener('beforeinstallprompt', (e) => {
      // –ë—Ä–∞—É–∑–µ—Ä —Ö–æ—á–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É. –ú—ã –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ.
      e.preventDefault();
      deferredPrompt = e;
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—à—É –∫–Ω–æ–ø–∫—É
      installBtn.style.display = 'block';
    });

    installBtn.addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        console.log(`User choice: ${outcome}`);
        deferredPrompt = null;
        installBtn.style.display = 'none';
      }
    });
  </script>
</body>
</html>